<div class="container">
    <!-- ä¸»æ ‡é¢˜ -->
    <div class="story-header">
        <h1>ğŸ’– æˆ‘ä»¬çš„çˆ±æƒ…æ—¶é’Ÿ</h1>
        <p>ä»2021å¹´8æœˆ18æ—¥å¼€å§‹çš„ç¾å¥½æ—…ç¨‹</p>
    </div>

    <!-- å®æ—¶æ‹çˆ±è®¡æ—¶å™¨ -->
    <div class="love-timer">
        <div class="timer-main">
            <div class="timer-big">
                <span id="love-years">4</span>å¹´
                <span id="love-months">0</span>æœˆ
                <span id="love-days">11</span>å¤©
            </div>
            <div class="timer-small">
                <span id="love-hours">00</span>:<span id="love-minutes">00</span>:<span id="love-seconds">00</span>
            </div>
        </div>
        <div class="total-days">
            å·²ç»ä¸€èµ·èµ°è¿‡äº† <span id="total-days">1476</span> ä¸ªæ—¥å¤œ
        </div>
    </div>

    <!-- ç®€æ´æ—¶é—´çº¿ -->
    <div class="simple-timeline">
        <div class="timeline-item">
            <span class="timeline-date">2021.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">æˆ‘ä»¬åœ¨ä¸€èµ·</span>
        </div>
        <div class="timeline-item">
            <span class="timeline-date">2022.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">ä¸€å‘¨å¹´</span>
        </div>
        <div class="timeline-item">
            <span class="timeline-date">2023.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">ä¸¤å‘¨å¹´</span>
        </div>
        <div class="timeline-item">
            <span class="timeline-date">2024.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">ä¸‰å‘¨å¹´</span>
        </div>
        <div class="timeline-item">
            <span class="timeline-date">2025.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">å››å‘¨å¹´</span>
        </div>
        <div class="timeline-item future">
            <span class="timeline-date">2026.08.18</span>
            <span class="timeline-dot">â—</span>
            <span class="timeline-text">äº”å‘¨å¹´</span>
        </div>
    </div>
</div>

<!-- å·¦ä¸‹è§’éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
<div class="music-toggle-btn" id="music-toggle">
    <span class="music-icon">ğŸ”‡</span>
</div>

<!-- èƒŒæ™¯éŸ³ä¹ -->
<audio id="bg-music" loop>
    <source src="/music/love-theme.mp3" type="audio/mp3">
</audio>

<style>
/* ç®€æ´æ ·å¼ */
.story-header {
    text-align: center;
    margin-bottom: 30px;
}

.story-header h1 {
    color: #e84393;
    font-size: 2.2em;
    margin-bottom: 10px;
}

.story-header p {
    color: #666;
    font-size: 1.1em;
}

/* çˆ±æƒ…è®¡æ—¶å™¨ */
.love-timer {
    background: linear-gradient(135deg, #ff6b6b, #e84393);
    padding: 25px;
    border-radius: 20px;
    margin: 25px 0;
    color: white;
    text-align: center;
}

.timer-main {
    margin-bottom: 15px;
}

.timer-big {
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 10px;
}

.timer-big span {
    font-size: 1.5em;
    margin: 0 5px;
}

.timer-small {
    font-size: 1.5em;
    font-family: 'Courier New', monospace;
}

.timer-small span {
    background: rgba(255, 255, 255, 0.2);
    padding: 5px 10px;
    border-radius: 5px;
    margin: 0 2px;
}

.total-days {
    font-size: 1.1em;
    opacity: 0.9;
}

/* ç®€æ´æ—¶é—´çº¿ */
.simple-timeline {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    margin: 25px 0;
}

.timeline-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.timeline-date {
    font-size: 0.9em;
    color: #e84393;
    font-weight: 500;
}

.timeline-dot {
    color: #e84393;
    font-size: 1.2em;
}

.timeline-text {
    font-size: 0.9em;
    color: #666;
}

.timeline-item.future .timeline-date,
.timeline-item.future .timeline-dot {
    color: #4facfe;
}

/* å·¦ä¸‹è§’éŸ³ä¹æ§åˆ¶æŒ‰é’® */
.music-toggle-btn {
    position: fixed;
    left: 20px;
    bottom: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    transition: all 0.3s ease;
}

.music-toggle-btn:hover {
    transform: scale(1.1);
}

.music-icon {
    font-size: 1.5em;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .timer-big {
        font-size: 1.6em;
    }
    
    .timer-big span {
        font-size: 1.3em;
    }
    
    .timer-small {
        font-size: 1.2em;
    }
    
    .simple-timeline {
        flex-direction: column;
        gap: 10px;
    }
    
    .timeline-item {
        width: 100%;
        justify-content: center;
    }
    
    .music-toggle-btn {
        left: 15px;
        bottom: 15px;
        width: 45px;
        height: 45px;
    }
}
</style>

<script>
// ä¿®å¤çš„è®¡æ—¶å™¨åŠŸèƒ½
(function() {
    const startDate = new Date('2021-08-18T00:00:00');
    let audioElement = null;
    let isMusicPlaying = false;
    
    function initLoveTimer() {
        // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
        updateTimer();
        // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´
        setInterval(updateTimer, 1000);
        
        // è®¾ç½®éŸ³ä¹æ§åˆ¶
        setupMusicControl();
        
        // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
        tryAutoPlayMusic();
    }
    
    function updateTimer() {
        const now = new Date();
        const diff = now - startDate;
        
        // è®¡ç®—æ€»å¤©æ•°
        const totalDays = Math.floor(diff / (1000 * 60 * 60 * 24));
        
        // è®¡ç®—å¹´ã€æœˆã€æ—¥ï¼ˆå‡†ç¡®çš„è®¡ç®—ï¼‰
        const startYear = startDate.getFullYear();
        const currentYear = now.getFullYear();
        let years = currentYear - startYear;
        
        // è°ƒæ•´å¹´æ•°ï¼ˆå¦‚æœä»Šå¹´è¿˜æ²¡åˆ°8æœˆ18æ—¥ï¼‰
        if (now.getMonth() < 7 || (now.getMonth() === 7 && now.getDate() < 18)) {
            years--;
        }
        
        // è®¡ç®—æœˆä»½ï¼ˆä»æœ€åä¸€ä¸ªå‘¨å¹´çºªå¿µæ—¥åˆ°ç°åœ¨ï¼‰
        const lastAnniversary = new Date(currentYear, 7, 18); // 8æœˆï¼ˆæœˆä»½ä»0å¼€å§‹ï¼‰
        if (now < lastAnniversary) {
            lastAnniversary.setFullYear(currentYear - 1);
        }
        
        const monthDiff = (now.getFullYear() - lastAnniversary.getFullYear()) * 12 + 
                         (now.getMonth() - lastAnniversary.getMonth());
        const months = monthDiff % 12;
        
        // è®¡ç®—å¤©æ•°ï¼ˆä»å½“æœˆå¼€å§‹ï¼‰
        const days = now.getDate() - 18;
        const adjustedDays = days >= 0 ? days : 30 + days; // å¤„ç†è´Ÿæ•°
        
        // æ›´æ–°æ˜¾ç¤º
        document.getElementById('love-years').textContent = years;
        document.getElementById('love-months').textContent = months;
        document.getElementById('love-days').textContent = adjustedDays;
        document.getElementById('total-days').textContent = totalDays;
        
        // æ›´æ–°æ—¶åˆ†ç§’ï¼ˆå®æ—¶ï¼‰
        document.getElementById('love-hours').textContent = now.getHours().toString().padStart(2, '0');
        document.getElementById('love-minutes').textContent = now.getMinutes().toString().padStart(2, '0');
        document.getElementById('love-seconds').textContent = now.getSeconds().toString().padStart(2, '0');
    }
    
    function setupMusicControl() {
        audioElement = document.getElementById('bg-music');
        const toggleBtn = document.getElementById('music-toggle');
        
        if (!audioElement || !toggleBtn) return;
        
        // è®¾ç½®é»˜è®¤éŸ³é‡
        audioElement.volume = 0.4;
        
        // éŸ³ä¹åˆ‡æ¢æŒ‰é’®
        toggleBtn.addEventListener('click', function() {
            if (isMusicPlaying) {
                audioElement.pause();
                isMusicPlaying = false;
                toggleBtn.innerHTML = '<span class="music-icon">ğŸ”‡</span>';
            } else {
                audioElement.play().then(() => {
                    isMusicPlaying = true;
                    toggleBtn.innerHTML = '<span class="music-icon">ğŸ”Š</span>';
                }).catch((error) => {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    toggleBtn.innerHTML = '<span class="music-icon">âŒ</span>';
                });
            }
        });
        
        // ç›‘å¬éŸ³ä¹ç»“æŸå’Œé”™è¯¯
        audioElement.addEventListener('ended', function() {
            isMusicPlaying = false;
            toggleBtn.innerHTML = '<span class="music-icon">ğŸ”‡</span>';
        });
        
        audioElement.addEventListener('error', function() {
            isMusicPlaying = false;
            toggleBtn.innerHTML = '<span class="music-icon">âŒ</span>';
        });
    }
    
    function tryAutoPlayMusic() {
        // ç°ä»£æµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½è‡ªåŠ¨æ’­æ”¾
        // æˆ‘ä»¬å…ˆé™éŸ³å°è¯•æ’­æ”¾ï¼Œç­‰ç”¨æˆ·äº¤äº’åå†å–æ¶ˆé™éŸ³
        if (audioElement) {
            audioElement.muted = true;
            audioElement.play().then(() => {
                // æ’­æ”¾æˆåŠŸï¼Œè®¾ç½®æ ‡å¿—ä½ä½†ä¿æŒé™éŸ³
                isMusicPlaying = true;
                document.getElementById('music-toggle').innerHTML = '<span class="music-icon">ğŸ”‡</span>';
            }).catch(() => {
                // è‡ªåŠ¨æ’­æ”¾å¤±è´¥æ˜¯æ­£å¸¸çš„
                isMusicPlaying = false;
            });
        }
    }
    
    // ç”¨æˆ·äº¤äº’åå–æ¶ˆé™éŸ³
    function enableSound() {
        if (audioElement && isMusicPlaying) {
            audioElement.muted = false;
            document.getElementById('music-toggle').innerHTML = '<span class="music-icon">ğŸ”Š</span>';
        }
    }
    
    // ç›‘å¬ç”¨æˆ·äº¤äº’
    document.addEventListener('click', enableSound);
    document.addEventListener('touchstart', enableSound);
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initLoveTimer);
})();
</script>